<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Eval Monitor</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', system-ui, sans-serif; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const AIEvalMonitor = () => {
            const [query, setQuery] = useState('AI eval');
            const [mentions, setMentions] = useState([]);
            const [filter, setFilter] = useState('all');
            const [loading, setLoading] = useState(false);
            const [lastUpdate, setLastUpdate] = useState('--');
            const [summary, setSummary] = useState('');
            const [summaryLoading, setSummaryLoading] = useState(false);
            const [showSummary, setShowSummary] = useState(false);
            const [showNotice, setShowNotice] = useState(true);

            const analyzeSentiment = (text) => {
                const positive = ['breakthrough', 'success', 'excellent', 'great', 'amazing', 'innovative', 'progress', 'improve', 'better', 'good', 'exciting', 'promising'];
                const negative = ['fail', 'problem', 'issue', 'concern', 'risk', 'danger', 'bad', 'worse', 'difficult', 'challenge', 'controversy', 'criticism'];
                const lower = text.toLowerCase();
                let score = 0;
                positive.forEach(w => { if (lower.includes(w)) score++; });
                negative.forEach(w => { if (lower.includes(w)) score--; });
                return score > 0 ? 'positive' : score < 0 ? 'negative' : 'neutral';
            };

            const searchReddit = async (q) => {
                try {
                    const response = await fetch(`https://www.reddit.com/search.json?q=${encodeURIComponent(q)}&sort=new&limit=25`);
                    const data = await response.json();
                    return data.data.children.map(post => ({
                        source: 'reddit',
                        title: post.data.title,
                        content: post.data.selftext?.slice(0, 300) || '',
                        author: `u/${post.data.author}`,
                        subreddit: `r/${post.data.subreddit}`,
                        url: `https://reddit.com${post.data.permalink}`,
                        date: new Date(post.data.created_utc * 1000).toISOString(),
                        score: post.data.score,
                        comments: post.data.num_comments,
                        sentiment: analyzeSentiment(post.data.title + ' ' + (post.data.selftext || ''))
                    }));
                } catch (error) {
                    console.error('Reddit error:', error);
                    return [];
                }
            };

            const searchHackerNews = async (q) => {
                try {
                    const response = await fetch(`https://hn.algolia.com/api/v1/search?query=${encodeURIComponent(q)}&tags=story&hitsPerPage=25`);
                    const data = await response.json();
                    return data.hits.map(story => ({
                        source: 'hackernews',
                        title: story.title,
                        content: '',
                        author: story.author,
                        url: story.url || `https://news.ycombinator.com/item?id=${story.objectID}`,
                        hnUrl: `https://news.ycombinator.com/item?id=${story.objectID}`,
                        date: story.created_at,
                        score: story.points,
                        comments: story.num_comments,
                        sentiment: analyzeSentiment(story.title)
                    }));
                } catch (error) {
                    console.error('HN error:', error);
                    return [];
                }
            };

            const searchGoogleNews = async (q) => {
                const googleNewsUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=en-US&gl=US&ceid=US:en`;
                
                // Try multiple CORS proxies as fallbacks
                const proxies = [
                    (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                    (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,
                    (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
                ];

                for (const getProxyUrl of proxies) {
                    try {
                        const proxyUrl = getProxyUrl(googleNewsUrl);
                        const response = await fetch(proxyUrl);
                        
                        if (!response.ok) continue;
                        
                        const text = await response.text();
                        
                        // Check if we got valid XML
                        if (!text.includes('<item>')) continue;
                        
                        const parser = new DOMParser();
                        const xml = parser.parseFromString(text, 'text/xml');
                        const items = xml.querySelectorAll('item');
                        
                        if (items.length === 0) continue;
                        
                        const articles = [];
                        items.forEach((item, index) => {
                            if (index >= 20) return;
                            const title = item.querySelector('title')?.textContent || '';
                            const link = item.querySelector('link')?.textContent || '';
                            const pubDate = item.querySelector('pubDate')?.textContent || '';
                            const source = item.querySelector('source')?.textContent || 'News';
                            if (!title || title.includes('[Removed]')) return;
                            articles.push({
                                source: 'news',
                                title,
                                content: '',
                                author: source,
                                publisher: source,
                                url: link,
                                date: pubDate ? new Date(pubDate).toISOString() : new Date().toISOString(),
                                sentiment: analyzeSentiment(title)
                            });
                        });
                        
                        if (articles.length > 0) {
                            console.log(`Google News: Found ${articles.length} articles`);
                            return articles;
                        }
                    } catch (error) {
                        console.log('Proxy failed, trying next...', error.message);
                        continue;
                    }
                }
                
                console.error('All Google News proxies failed');
                return [];
            };

            const getTwitterPlaceholder = (q) => [{
                source: 'twitter',
                title: `üîç Search Twitter for "${q}"`,
                content: 'Click to search Twitter/X directly.',
                author: 'Twitter/X',
                url: `https://twitter.com/search?q=${encodeURIComponent(q)}&src=typed_query&f=live`,
                date: new Date().toISOString(),
                sentiment: 'neutral',
                isPlaceholder: true
            }];

            const startSearch = async () => {
                if (!query.trim()) return;
                setLoading(true);
                setMentions([]);

                try {
                    const [reddit, hn, news, twitter] = await Promise.all([
                        searchReddit(query),
                        searchHackerNews(query),
                        searchGoogleNews(query),
                        Promise.resolve(getTwitterPlaceholder(query))
                    ]);

                    const all = [...reddit, ...hn, ...news, ...twitter].sort((a, b) => new Date(b.date) - new Date(a.date));
                    setMentions(all);
                    setLastUpdate(new Date().toLocaleTimeString());
                    generateSummary(all, query);
                } catch (error) {
                    console.error('Search error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const generateSummary = async (mentionsList, searchQuery) => {
                const realMentions = mentionsList.filter(m => !m.isPlaceholder);
                if (realMentions.length === 0) {
                    setShowSummary(false);
                    return;
                }

                setShowSummary(true);
                setSummaryLoading(true);

                // Generate local summary (no API needed)
                const sources = {};
                const sentiments = { positive: 0, negative: 0, neutral: 0 };
                realMentions.forEach(m => {
                    sources[m.source] = (sources[m.source] || 0) + 1;
                    sentiments[m.sentiment]++;
                });
                
                const sortedSources = Object.entries(sources).sort((a, b) => b[1] - a[1]);
                const topSource = sortedSources[0];
                const posPercent = Math.round((sentiments.positive / realMentions.length) * 100);
                const negPercent = Math.round((sentiments.negative / realMentions.length) * 100);
                
                let sentimentDesc = 'mixed';
                if (posPercent > 50) sentimentDesc = 'predominantly positive';
                else if (negPercent > 50) sentimentDesc = 'predominantly negative';

                const topTitles = realMentions.slice(0, 3).map(m => `"${m.title.slice(0, 60)}${m.title.length > 60 ? '...' : ''}"`).join(', ');

                setSummary(`**Overview:** Found **${realMentions.length} mentions** of "${searchQuery}" across ${Object.keys(sources).length} sources. The overall sentiment is **${sentimentDesc}** (${posPercent}% positive, ${negPercent}% negative).\n\n**Top Source:** ${topSource[0].charAt(0).toUpperCase() + topSource[0].slice(1)} leads with **${topSource[1]} mentions**, followed by ${sortedSources[1] ? sortedSources[1][0] + ' (' + sortedSources[1][1] + ')' : 'others'}.\n\n**Recent Headlines:** ${topTitles}`);
                setSummaryLoading(false);
            };

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                const diff = Date.now() - date;
                const mins = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                if (mins < 60) return `${mins}m ago`;
                if (hours < 24) return `${hours}h ago`;
                if (days < 7) return `${days}d ago`;
                return date.toLocaleDateString();
            };

            const filteredMentions = filter === 'all' ? mentions : mentions.filter(m => m.source === filter);
            
            const stats = {
                total: mentions.length,
                twitter: mentions.filter(m => m.source === 'twitter').length,
                news: mentions.filter(m => m.source === 'news').length,
                reddit: mentions.filter(m => m.source === 'reddit').length,
                hn: mentions.filter(m => m.source === 'hackernews').length
            };

            const sourceColors = {
                news: { bg: '#F5F3FF', color: '#7C3AED', icon: 'N' },
                reddit: { bg: '#FFF7ED', color: '#EA580C', icon: 'R' },
                hackernews: { bg: '#FFF7ED', color: '#FF6600', icon: 'Y' },
                twitter: { bg: '#F7F7F7', color: '#000', icon: 'ùïè' }
            };

            const sentimentColors = {
                positive: { bg: '#ECFDF5', color: '#059669' },
                negative: { bg: '#FEF2F2', color: '#DC2626' },
                neutral: { bg: '#F5F5F3', color: '#5A5A5A' }
            };

            return (
                <div style={{ fontFamily: "'DM Sans', system-ui, sans-serif", background: '#FAFAF8', minHeight: '100vh', color: '#1A1A1A' }}>
                    {/* Header */}
                    <header style={{ background: '#fff', borderBottom: '1px solid #E8E8E6', padding: '16px 24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', position: 'sticky', top: 0, zIndex: 100 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                            <div style={{ width: 36, height: 36, background: '#2563EB', borderRadius: 6, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontWeight: 700, fontSize: 13 }}>AE</div>
                            <div style={{ fontSize: 20, fontWeight: 600 }}>AI Eval Monitor</div>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, fontSize: 13, color: '#5A5A5A' }}>
                                <div style={{ width: 8, height: 8, background: loading ? '#F59E0B' : '#059669', borderRadius: '50%', animation: loading ? 'pulse 1.5s infinite' : 'none' }} />
                                {loading ? 'Searching...' : 'Ready'}
                            </div>
                            <div style={{ fontSize: 13, color: '#8A8A8A' }}>Updated: {lastUpdate}</div>
                        </div>
                    </header>

                    <main style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>
                        {/* Info Notice */}
                        {showNotice && (
                            <div style={{ background: '#EFF6FF', border: '1px solid #BFDBFE', borderRadius: 10, padding: 16, marginBottom: 24 }}>
                                <div style={{ fontSize: 14, fontWeight: 600, color: '#2563EB', marginBottom: 8 }}>‚ÑπÔ∏è How It Works</div>
                                <p style={{ fontSize: 13, color: '#5A5A5A', margin: '4px 0' }}><strong>News:</strong> Google News ‚Ä¢ <strong>Reddit & HN:</strong> Automatic ‚Ä¢ <strong>Twitter:</strong> Opens in new tab</p>
                                <button onClick={() => setShowNotice(false)} style={{ background: 'none', border: 'none', color: '#2563EB', fontSize: 12, cursor: 'pointer', marginTop: 8 }}>Hide ‚Üë</button>
                            </div>
                        )}

                        {/* Search */}
                        <div style={{ background: '#fff', border: '1px solid #E8E8E6', borderRadius: 14, padding: 24, marginBottom: 24 }}>
                            <div style={{ display: 'flex', gap: 12, marginBottom: 16 }}>
                                <div style={{ flex: 1, position: 'relative' }}>
                                    <span style={{ position: 'absolute', left: 14, top: '50%', transform: 'translateY(-50%)', color: '#8A8A8A' }}>üîç</span>
                                    <input
                                        type="text"
                                        value={query}
                                        onChange={(e) => setQuery(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && startSearch()}
                                        placeholder="Enter topic to monitor..."
                                        style={{ width: '100%', padding: '12px 16px 12px 44px', background: '#F5F5F3', border: '1px solid #E8E8E6', borderRadius: 10, fontSize: 15, outline: 'none' }}
                                    />
                                </div>
                                <button
                                    onClick={startSearch}
                                    disabled={loading}
                                    style={{ padding: '12px 24px', background: '#2563EB', border: 'none', borderRadius: 10, color: '#fff', fontWeight: 600, fontSize: 14, cursor: loading ? 'not-allowed' : 'pointer', opacity: loading ? 0.6 : 1 }}
                                >
                                    {loading ? 'Searching...' : 'Search All Sources'}
                                </button>
                            </div>
                            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
                                {['all', 'twitter', 'news', 'reddit', 'hackernews'].map(f => (
                                    <button
                                        key={f}
                                        onClick={() => setFilter(f)}
                                        style={{
                                            padding: '8px 14px',
                                            background: filter === f ? '#EFF6FF' : '#F5F5F3',
                                            border: `1px solid ${filter === f ? '#2563EB' : '#E8E8E6'}`,
                                            borderRadius: 20,
                                            fontSize: 13,
                                            color: filter === f ? '#2563EB' : '#5A5A5A',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        {f === 'all' ? 'All Sources' : f === 'hackernews' ? 'Hacker News' : f.charAt(0).toUpperCase() + f.slice(1)}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Summary */}
                        {showSummary && (
                            <div style={{ background: 'linear-gradient(135deg, #F0F9FF 0%, #F5F3FF 100%)', border: '1px solid #DBEAFE', borderRadius: 14, padding: 24, marginBottom: 24 }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                    <div style={{ fontSize: 18, fontWeight: 600, display: 'flex', alignItems: 'center', gap: 10 }}>
                                        <span style={{ background: 'linear-gradient(135deg, #2563EB, #7C3AED)', borderRadius: 8, padding: '6px 10px', color: '#fff' }}>‚ú®</span>
                                        Daily Summary
                                    </div>
                                    <button onClick={() => setShowSummary(false)} style={{ background: 'none', border: 'none', color: '#8A8A8A', cursor: 'pointer', fontSize: 18 }}>‚úï</button>
                                </div>
                                {summaryLoading ? (
                                    <div style={{ color: '#8A8A8A', fontSize: 14 }}>‚è≥ Generating summary...</div>
                                ) : (
                                    <div style={{ fontSize: 15, lineHeight: 1.7, color: '#5A5A5A' }}>
                                        {summary.split('\n\n').map((p, i) => (
                                            <p key={i} style={{ marginBottom: 12 }} dangerouslySetInnerHTML={{ __html: p.replace(/\*\*(.*?)\*\*/g, '<strong style="color:#1A1A1A">$1</strong>') }} />
                                        ))}
                                    </div>
                                )}
                                <div style={{ marginTop: 16, paddingTop: 16, borderTop: '1px solid #DBEAFE', display: 'flex', gap: 12 }}>
                                    <button onClick={() => generateSummary(mentions, query)} style={{ padding: '8px 16px', background: '#2563EB', border: 'none', borderRadius: 6, color: '#fff', fontSize: 13, cursor: 'pointer' }}>üîÑ Regenerate</button>
                                    <button onClick={() => navigator.clipboard.writeText(summary.replace(/\*\*/g, ''))} style={{ padding: '8px 16px', background: '#fff', border: '1px solid #E8E8E6', borderRadius: 6, color: '#5A5A5A', fontSize: 13, cursor: 'pointer' }}>üìã Copy</button>
                                </div>
                            </div>
                        )}

                        {/* Stats */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: 16, marginBottom: 24 }}>
                            {[
                                { label: 'Total', value: stats.total, meta: 'mentions' },
                                { label: 'Twitter/X', value: stats.twitter, meta: 'tweets' },
                                { label: 'News', value: stats.news, meta: 'articles' },
                                { label: 'Reddit', value: stats.reddit, meta: 'posts' },
                                { label: 'HN', value: stats.hn, meta: 'stories' }
                            ].map((stat, i) => (
                                <div key={i} style={{ background: '#fff', border: '1px solid #E8E8E6', borderRadius: 10, padding: 20 }}>
                                    <div style={{ fontSize: 13, color: '#8A8A8A', marginBottom: 6 }}>{stat.label}</div>
                                    <div style={{ fontSize: 28, fontWeight: 700 }}>{stat.value}</div>
                                    <div style={{ fontSize: 12, color: '#5A5A5A' }}>{stat.meta}</div>
                                </div>
                            ))}
                        </div>

                        {/* Mentions List */}
                        <div style={{ background: '#fff', border: '1px solid #E8E8E6', borderRadius: 14, overflow: 'hidden' }}>
                            <div style={{ padding: '18px 24px', borderBottom: '1px solid #E8E8E6', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: 12 }}>
                                <div style={{ fontSize: 15, fontWeight: 600 }}>
                                    Mentions <span style={{ background: '#F5F5F3', padding: '3px 10px', borderRadius: 12, fontSize: 12, marginLeft: 8 }}>{filteredMentions.length}</span>
                                </div>
                                <div style={{ display: 'flex', gap: 8 }}>
                                    <button onClick={() => window.open(`https://twitter.com/search?q=${encodeURIComponent(query)}&f=live`, '_blank')} style={{ padding: '6px 12px', background: '#F5F5F3', border: '1px solid #E8E8E6', borderRadius: 6, fontSize: 12, color: '#5A5A5A', cursor: 'pointer' }}>Search on ùïè</button>
                                </div>
                            </div>
                            <div style={{ maxHeight: 600, overflowY: 'auto' }}>
                                {filteredMentions.length === 0 ? (
                                    <div style={{ padding: 60, textAlign: 'center' }}>
                                        <div style={{ fontSize: 48, marginBottom: 16 }}>üîç</div>
                                        <div style={{ fontSize: 16, fontWeight: 600, marginBottom: 8 }}>Search for mentions</div>
                                        <div style={{ fontSize: 14, color: '#8A8A8A' }}>Enter a topic and click search</div>
                                    </div>
                                ) : (
                                    filteredMentions.map((m, i) => {
                                        const sc = sourceColors[m.source] || sourceColors.news;
                                        const sent = sentimentColors[m.sentiment];
                                        return (
                                            <div key={i} style={{ padding: '20px 24px', borderBottom: '1px solid #E8E8E6' }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10, flexWrap: 'wrap', gap: 8 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                                        <div style={{ width: 32, height: 32, background: sc.bg, color: sc.color, borderRadius: 6, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 12, fontWeight: 700 }}>{sc.icon}</div>
                                                        <div>
                                                            <div style={{ fontSize: 14, fontWeight: 600 }}>{m.author || m.publisher || m.source}</div>
                                                            <div style={{ fontSize: 12, color: '#8A8A8A' }}>{m.subreddit || m.publisher || m.source}</div>
                                                        </div>
                                                    </div>
                                                    <div style={{ fontSize: 12, color: '#8A8A8A' }}>{formatDate(m.date)}</div>
                                                </div>
                                                <a href={m.url} target="_blank" rel="noopener noreferrer" style={{ fontSize: 16, fontWeight: 600, color: '#1A1A1A', textDecoration: 'none', display: 'block', marginBottom: 8, lineHeight: 1.4 }}>
                                                    {m.title}
                                                </a>
                                                {m.content && <div style={{ fontSize: 14, color: '#5A5A5A', marginBottom: 12 }}>{m.content.slice(0, 200)}</div>}
                                                <div style={{ display: 'flex', alignItems: 'center', gap: 16, flexWrap: 'wrap' }}>
                                                    <span style={{ padding: '4px 10px', borderRadius: 12, fontSize: 11, fontWeight: 600, textTransform: 'uppercase', background: sent.bg, color: sent.color }}>{m.sentiment}</span>
                                                    {m.score !== undefined && <span style={{ fontSize: 12, color: '#8A8A8A' }}>‚Üë {m.score}</span>}
                                                    {m.comments !== undefined && <span style={{ fontSize: 12, color: '#8A8A8A' }}>üí¨ {m.comments}</span>}
                                                    <a href={m.hnUrl || m.url} target="_blank" rel="noopener noreferrer" style={{ fontSize: 13, color: '#2563EB', marginLeft: 'auto', textDecoration: 'none' }}>Open ‚Üí</a>
                                                </div>
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<AIEvalMonitor />, document.getElementById('root'));
    </script>
</body>
</html>
